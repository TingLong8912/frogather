{"ast":null,"code":"import React from 'react';\nimport { useContext, useEffect } from \"react\";\nimport { message } from 'antd';\nimport MapContext from \"./../../hook/MapContext\";\nimport { Vector as VectorLayer } from 'ol/layer.js';\nimport Draw from 'ol/interaction/Draw.js';\nlet draw; // global so we can remove it later\nconst addInteraction = () => {\n  draw = new Draw({\n    source: source,\n    type: \"Point\"\n  });\n  draw.on('drawend', function (evt) {\n    var _map;\n    (_map = map) === null || _map === void 0 ? void 0 : _map.removeInteraction(draw);\n    var feature = evt.feature;\n    var coords = feature.getGeometry().getCoordinates();\n    setUserCoord(coords);\n    message.success(\"繪製成功，請回到表單填寫地點名稱\");\n  }, this);\n  if (isDraw) {\n    var _map2;\n    (_map2 = map) === null || _map2 === void 0 ? void 0 : _map2.addInteraction(draw);\n  }\n};\nconst clearLayer = () => {\n  map.getLayers().forEach(layer => {\n    if (layer.get('name') === 'draw') {\n      layer.getSource().clear();\n    }\n  });\n};\nconst DrawVectorLayer = ({\n  name,\n  source,\n  style,\n  zIndex\n}) => {\n  const {\n    map,\n    isDraw,\n    setIsDraw,\n    userCoord,\n    setUserCoord\n  } = useContext(MapContext);\n  useEffect(() => {\n    if (!map) return;\n    let vectorLayer = new VectorLayer({\n      name,\n      source,\n      style\n    });\n    map.addLayer(vectorLayer);\n    vectorLayer.setZIndex(zIndex);\n    addInteraction();\n    return () => {\n      if (map) {\n        map.removeLayer(vectorLayer);\n      }\n    };\n  }, [map]);\n  useEffect(() => {\n    if (!map) return;\n    clearLayer();\n    let vectorLayer = new VectorLayer({\n      name,\n      source,\n      style\n    });\n    map.addLayer(vectorLayer);\n  }, [userCoord]);\n  useEffect(() => {\n    if (isDraw) {\n      clearLayer();\n      addInteraction();\n      setIsDraw(false);\n    }\n  }, [isDraw]);\n  return null;\n};\nexport default DrawVectorLayer;","map":{"version":3,"names":["React","useContext","useEffect","message","MapContext","Vector","VectorLayer","Draw","draw","addInteraction","source","type","on","evt","_map","map","removeInteraction","feature","coords","getGeometry","getCoordinates","setUserCoord","success","isDraw","_map2","clearLayer","getLayers","forEach","layer","get","getSource","clear","DrawVectorLayer","name","style","zIndex","setIsDraw","userCoord","vectorLayer","addLayer","setZIndex","removeLayer"],"sources":["/Users/yantinglong/Documents/project/frogather/src/components/Layers/DrawVectorLayer.js"],"sourcesContent":["import React from 'react';\nimport { useContext, useEffect } from \"react\";\nimport { message } from 'antd';\nimport MapContext from \"./../../hook/MapContext\";\nimport { Vector as VectorLayer } from 'ol/layer.js';\nimport Draw from 'ol/interaction/Draw.js';\n\nlet draw; // global so we can remove it later\nconst addInteraction = () => {\n\tdraw = new Draw({\n\t\tsource: source,\n\t\ttype: \"Point\",\n\t});\n\tdraw.on('drawend', function(evt) {\n\t\tmap?.removeInteraction(draw);\n\t\tvar feature = evt.feature;\n\t\tvar coords = feature.getGeometry().getCoordinates();\n\t\tsetUserCoord(coords);\n\t\tmessage.success(\"繪製成功，請回到表單填寫地點名稱\")\n\t}, this);\n\tif (isDraw) {\n\t\tmap?.addInteraction(draw);\n\t}\n};\n\nconst clearLayer = () => {\n\tmap.getLayers().forEach((layer) => {\n\t\tif (layer.get('name') === 'draw') {\n\t\t\tlayer.getSource().clear();\n\t\t}\n\t});\n};\n\nconst DrawVectorLayer = ({ name, source, style, zIndex }) => {\n\tconst { map, isDraw, setIsDraw, userCoord, setUserCoord } = useContext(MapContext);\n\n\tuseEffect(()=>{\n\t\tif (!map) return;\n\t\tlet vectorLayer = new VectorLayer({\n\t\t\tname,\n\t\t\tsource,\n\t\t\tstyle\n\t\t});\n\t\tmap.addLayer(vectorLayer);\n\t\tvectorLayer.setZIndex(zIndex);\n\t\taddInteraction();\n\n\t\treturn () => {\n\t\t\tif (map) {\n\t\t\t\tmap.removeLayer(vectorLayer);\n\t\t\t}\n\t\t};\n\t}, [map]);\n\n\tuseEffect(()=>{\n\t\tif (!map) return;\n\t\tclearLayer();\n\t\tlet vectorLayer = new VectorLayer({\n\t\t\tname,\n\t\t\tsource,\n\t\t\tstyle\n\t\t});\n\t\tmap.addLayer(vectorLayer);\n\t}, [userCoord]);\n\n\n  useEffect(()=>{\n\t\tif (isDraw) {\n\t\t\tclearLayer();\n\t\t\taddInteraction();\n\t\t\tsetIsDraw(false);\n\t\t}\n  }, [isDraw]);\n\n\treturn null;\n};\n\nexport default DrawVectorLayer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}