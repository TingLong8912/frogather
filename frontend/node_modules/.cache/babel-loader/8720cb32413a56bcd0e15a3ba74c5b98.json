{"ast":null,"code":"/**\n * @module ol/source/ImageStatic\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport EventType from '../events/EventType.js';\nimport ImageSource, { defaultImageLoadFunction } from './Image.js';\nimport ImageState from '../ImageState.js';\nimport ImageWrapper from '../Image.js';\nimport { IMAGE_SMOOTHING_DISABLED } from '../renderer/canvas/common.js';\nimport { assign } from '../obj.js';\nimport { createCanvasContext2D } from '../dom.js';\nimport { getHeight, getWidth, intersects } from '../extent.js';\nimport { get as getProjection } from '../proj.js';\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {import(\"../extent.js\").Extent} [imageExtent] Extent of the image in map coordinates.\n * This is the [left, bottom, right, top] map coordinates of your image.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [imageSmoothing=true] Deprecated.  Use the `interpolate` option instead.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {import(\"../size.js\").Size} [imageSize] Size of the image in pixels. Usually the image size is auto-detected, so this\n * only needs to be set if auto-detection fails for some reason.\n * @property {string} url Image URL.\n */\n/**\n * @classdesc\n * A layer source for displaying a single, static image.\n * @api\n */\nvar Static = /** @class */function (_super) {\n  __extends(Static, _super);\n  /**\n   * @param {Options} options ImageStatic options.\n   */\n  function Static(options) {\n    var _this = this;\n    var crossOrigin = options.crossOrigin !== undefined ? options.crossOrigin : null;\n    var /** @type {import(\"../Image.js\").LoadFunction} */imageLoadFunction = options.imageLoadFunction !== undefined ? options.imageLoadFunction : defaultImageLoadFunction;\n    var interpolate = options.imageSmoothing !== undefined ? options.imageSmoothing : true;\n    if (options.interpolate !== undefined) {\n      interpolate = options.interpolate;\n    }\n    _this = _super.call(this, {\n      attributions: options.attributions,\n      interpolate: interpolate,\n      projection: getProjection(options.projection)\n    }) || this;\n    /**\n     * @private\n     * @type {string}\n     */\n    _this.url_ = options.url;\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    _this.imageExtent_ = options.imageExtent;\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    _this.image_ = new ImageWrapper(_this.imageExtent_, undefined, 1, _this.url_, crossOrigin, imageLoadFunction);\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size|null}\n     */\n    _this.imageSize_ = options.imageSize ? options.imageSize : null;\n    _this.image_.addEventListener(EventType.CHANGE, _this.handleImageChange.bind(_this));\n    return _this;\n  }\n  /**\n   * Returns the image extent\n   * @return {import(\"../extent.js\").Extent} image extent.\n   * @api\n   */\n  Static.prototype.getImageExtent = function () {\n    return this.imageExtent_;\n  };\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   */\n  Static.prototype.getImageInternal = function (extent, resolution, pixelRatio, projection) {\n    if (intersects(extent, this.image_.getExtent())) {\n      return this.image_;\n    }\n    return null;\n  };\n  /**\n   * Return the URL used for this image source.\n   * @return {string} URL.\n   * @api\n   */\n  Static.prototype.getUrl = function () {\n    return this.url_;\n  };\n  /**\n   * @param {import(\"../events/Event.js\").default} evt Event.\n   */\n  Static.prototype.handleImageChange = function (evt) {\n    if (this.image_.getState() == ImageState.LOADED) {\n      var imageExtent = this.image_.getExtent();\n      var image = this.image_.getImage();\n      var imageWidth = void 0,\n        imageHeight = void 0;\n      if (this.imageSize_) {\n        imageWidth = this.imageSize_[0];\n        imageHeight = this.imageSize_[1];\n      } else {\n        imageWidth = image.width;\n        imageHeight = image.height;\n      }\n      var extentWidth = getWidth(imageExtent);\n      var extentHeight = getHeight(imageExtent);\n      var xResolution = extentWidth / imageWidth;\n      var yResolution = extentHeight / imageHeight;\n      var targetWidth = imageWidth;\n      var targetHeight = imageHeight;\n      if (xResolution > yResolution) {\n        targetWidth = Math.round(extentWidth / yResolution);\n      } else {\n        targetHeight = Math.round(extentHeight / xResolution);\n      }\n      if (targetWidth !== imageWidth || targetHeight !== imageHeight) {\n        var context = createCanvasContext2D(targetWidth, targetHeight);\n        if (!this.getInterpolate()) {\n          assign(context, IMAGE_SMOOTHING_DISABLED);\n        }\n        var canvas = context.canvas;\n        context.drawImage(image, 0, 0, imageWidth, imageHeight, 0, 0, canvas.width, canvas.height);\n        this.image_.setImage(canvas);\n      }\n    }\n    _super.prototype.handleImageChange.call(this, evt);\n  };\n  return Static;\n}(ImageSource);\nexport default Static;","map":{"version":3,"names":["EventType","ImageSource","defaultImageLoadFunction","ImageState","ImageWrapper","IMAGE_SMOOTHING_DISABLED","assign","createCanvasContext2D","getHeight","getWidth","intersects","get","getProjection","Static","_super","__extends","options","_this","crossOrigin","undefined","imageLoadFunction","interpolate","imageSmoothing","call","attributions","projection","url_","url","imageExtent_","imageExtent","image_","imageSize_","imageSize","addEventListener","CHANGE","handleImageChange","bind","prototype","getImageExtent","getImageInternal","extent","resolution","pixelRatio","getExtent","getUrl","evt","getState","LOADED","image","getImage","imageWidth","imageHeight","width","height","extentWidth","extentHeight","xResolution","yResolution","targetWidth","targetHeight","Math","round","context","getInterpolate","canvas","drawImage","setImage"],"sources":["../src/source/ImageStatic.js"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}