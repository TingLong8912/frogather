{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n/**\n * @module ol/source/DataTile\n */\nimport DataTile from '../DataTile.js';\nimport EventType from '../events/EventType.js';\nimport TileEventType from './TileEventType.js';\nimport TileSource, { TileSourceEvent } from './Tile.js';\nimport TileState from '../TileState.js';\nimport { assign } from '../obj.js';\nimport { createXYZ, extentFromProjection } from '../tilegrid.js';\nimport { getKeyZXY } from '../tilecoord.js';\nimport { getUid } from '../util.js';\nimport { toPromise } from '../functions.js';\nimport { toSize } from '../size.js';\n/**\n * Data tile loading function.  The function is called with z, x, and y tile coordinates and\n * returns {@link import(\"../DataTile.js\").Data data} for a tile or a promise for the same.\n * @typedef {function(number, number, number) : (import(\"../DataTile.js\").Data|Promise<import(\"../DataTile.js\").Data>)} Loader\n */\n/**\n * @typedef {Object} Options\n * @property {Loader} [loader] Data loader.  Called with z, x, and y tile coordinates.\n * Returns {@link import(\"../DataTile.js\").Data data} for a tile or a promise for the same.\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [maxZoom=42] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom=0] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=[256, 256]] The pixel width and height of the source tiles.\n * This may be different than the rendered pixel size if a `tileGrid` is provided.\n * @property {number} [gutter=0] The size in pixels of the gutter around data tiles to ignore.\n * This allows artifacts of rendering at tile edges to be ignored.\n * Supported data should be wider and taller than the tile size by a value of `2 x gutter`.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Tile projection.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {boolean} [opaque=false] Whether the layer is opaque.\n * @property {import(\"./Source.js\").State} [state] The source state.\n * @property {number} [tilePixelRatio] Deprecated.  To have tiles scaled, pass a `tileSize` representing\n * the source tile size and a `tileGrid` with the desired rendered tile size.\n * @property {boolean} [wrapX=false] Render tiles beyond the antimeridian.\n * @property {number} [transition] Transition time when fading in new tiles (in miliseconds).\n * @property {number} [bandCount=4] Number of bands represented in the data.\n * @property {boolean} [interpolate=false] Use interpolated values when resampling.  By default,\n * the nearest neighbor is used when resampling.\n */\n/**\n * @classdesc\n * A source for typed array data tiles.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n */\nvar DataTileSource = /** @class */function (_super) {\n  __extends(DataTileSource, _super);\n  /**\n   * @param {Options} options Image tile options.\n   */\n  function DataTileSource(options) {\n    var _this = this;\n    var projection = options.projection === undefined ? 'EPSG:3857' : options.projection;\n    var tileGrid = options.tileGrid;\n    if (tileGrid === undefined && projection) {\n      tileGrid = createXYZ({\n        extent: extentFromProjection(projection),\n        maxResolution: options.maxResolution,\n        maxZoom: options.maxZoom,\n        minZoom: options.minZoom,\n        tileSize: options.tileSize\n      });\n    }\n    _this = _super.call(this, {\n      cacheSize: 0.1,\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      projection: projection,\n      tileGrid: tileGrid,\n      opaque: options.opaque,\n      state: options.state,\n      tilePixelRatio: options.tilePixelRatio,\n      wrapX: options.wrapX,\n      transition: options.transition,\n      interpolate: options.interpolate\n    }) || this;\n    /**\n     * @private\n     * @type {number}\n     */\n    _this.gutter_ = options.gutter !== undefined ? options.gutter : 0;\n    /**\n     * @private\n     * @type {import('../size.js').Size|null}\n     */\n    _this.tileSize_ = options.tileSize ? toSize(options.tileSize) : null;\n    if (!_this.tileSize_ && options.tilePixelRatio && tileGrid) {\n      var renderTileSize = toSize(tileGrid.getTileSize(0));\n      _this.tileSize_ = [renderTileSize[0] * options.tilePixelRatio, renderTileSize[1] * options.tilePixelRatio];\n    }\n    /**\n     * @private\n     * @type {Array<import('../size.js').Size>|null}\n     */\n    _this.tileSizes_ = null;\n    /**\n     * @private\n     * @type {!Object<string, boolean>}\n     */\n    _this.tileLoadingKeys_ = {};\n    /**\n     * @private\n     */\n    _this.loader_ = options.loader;\n    _this.handleTileChange_ = _this.handleTileChange_.bind(_this);\n    /**\n     * @type {number}\n     */\n    _this.bandCount = options.bandCount === undefined ? 4 : options.bandCount; // assume RGBA if undefined\n    return _this;\n  }\n  /**\n   * Set the source tile sizes.  The length of the array is expected to match the number of\n   * levels in the tile grid.\n   * @protected\n   * @param {Array<import('../size.js').Size>} tileSizes An array of tile sizes.\n   */\n  DataTileSource.prototype.setTileSizes = function (tileSizes) {\n    this.tileSizes_ = tileSizes;\n  };\n  /**\n   * Get the source tile size at the given zoom level.  This may be different than the rendered tile\n   * size.\n   * @protected\n   * @param {number} z Tile zoom level.\n   * @return {import('../size.js').Size} The source tile size.\n   */\n  DataTileSource.prototype.getTileSize = function (z) {\n    if (this.tileSizes_) {\n      return this.tileSizes_[z];\n    }\n    if (this.tileSize_) {\n      return this.tileSize_;\n    }\n    var tileGrid = this.getTileGrid();\n    return tileGrid ? toSize(tileGrid.getTileSize(z)) : [256, 256];\n  };\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {number} Gutter.\n   */\n  DataTileSource.prototype.getGutterForProjection = function (projection) {\n    return this.gutter_;\n  };\n  /**\n   * @param {Loader} loader The data loader.\n   * @protected\n   */\n  DataTileSource.prototype.setLoader = function (loader) {\n    this.loader_ = loader;\n  };\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!DataTile} Tile.\n   */\n  DataTileSource.prototype.getTile = function (z, x, y, pixelRatio, projection) {\n    var size = this.getTileSize(z);\n    var tileCoordKey = getKeyZXY(z, x, y);\n    if (this.tileCache.containsKey(tileCoordKey)) {\n      return this.tileCache.get(tileCoordKey);\n    }\n    var sourceLoader = this.loader_;\n    function loader() {\n      return toPromise(function () {\n        return sourceLoader(z, x, y);\n      });\n    }\n    var options = assign({\n      tileCoord: [z, x, y],\n      loader: loader,\n      size: size\n    }, this.tileOptions);\n    var tile = new DataTile(options);\n    tile.key = this.getKey();\n    tile.addEventListener(EventType.CHANGE, this.handleTileChange_);\n    this.tileCache.set(tileCoordKey, tile);\n    return tile;\n  };\n  /**\n   * Handle tile change events.\n   * @param {import(\"../events/Event.js\").default} event Event.\n   */\n  DataTileSource.prototype.handleTileChange_ = function (event) {\n    var tile = /** @type {import(\"../Tile.js\").default} */event.target;\n    var uid = getUid(tile);\n    var tileState = tile.getState();\n    var type;\n    if (tileState == TileState.LOADING) {\n      this.tileLoadingKeys_[uid] = true;\n      type = TileEventType.TILELOADSTART;\n    } else if (uid in this.tileLoadingKeys_) {\n      delete this.tileLoadingKeys_[uid];\n      type = tileState == TileState.ERROR ? TileEventType.TILELOADERROR : tileState == TileState.LOADED ? TileEventType.TILELOADEND : undefined;\n    }\n    if (type) {\n      this.dispatchEvent(new TileSourceEvent(type, tile));\n    }\n  };\n  return DataTileSource;\n}(TileSource);\nexport default DataTileSource;","map":{"version":3,"names":["DataTile","EventType","TileEventType","TileSource","TileSourceEvent","TileState","assign","createXYZ","extentFromProjection","getKeyZXY","getUid","toPromise","toSize","DataTileSource","_super","__extends","options","_this","projection","undefined","tileGrid","extent","maxResolution","maxZoom","minZoom","tileSize","call","cacheSize","attributions","attributionsCollapsible","opaque","state","tilePixelRatio","wrapX","transition","interpolate","gutter_","gutter","tileSize_","renderTileSize","getTileSize","tileSizes_","tileLoadingKeys_","loader_","loader","handleTileChange_","bind","bandCount","prototype","setTileSizes","tileSizes","z","getTileGrid","getGutterForProjection","setLoader","getTile","x","y","pixelRatio","size","tileCoordKey","tileCache","containsKey","get","sourceLoader","tileCoord","tileOptions","tile","key","getKey","addEventListener","CHANGE","set","event","target","uid","tileState","getState","type","LOADING","TILELOADSTART","ERROR","TILELOADERROR","LOADED","TILELOADEND","dispatchEvent"],"sources":["../src/source/DataTile.js"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}