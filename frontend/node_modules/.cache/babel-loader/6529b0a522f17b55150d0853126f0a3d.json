{"ast":null,"code":"import React from 'react';\nimport { useContext, useEffect } from \"react\";\nimport { message } from 'antd';\nimport MapContext from \"./../../hook/MapContext\";\nimport { Vector as VectorLayer } from 'ol/layer.js';\nimport Draw from 'ol/interaction/Draw.js';\nconst DrawVectorLayer = ({\n  name,\n  source,\n  style,\n  zIndex\n}) => {\n  const {\n    map,\n    isDraw,\n    setIsDraw,\n    userCoord,\n    setUserCoord\n  } = useContext(MapContext);\n  useEffect(() => {\n    if (!map) return;\n    let vectorLayer = new VectorLayer({\n      name,\n      source,\n      style\n    });\n    map.addLayer(vectorLayer);\n    vectorLayer.setZIndex(zIndex);\n    addInteraction();\n    return () => {\n      if (map) {\n        map.removeLayer(vectorLayer);\n      }\n    };\n  }, [map]);\n  useEffect(() => {\n    if (!map) return;\n    clearLayer();\n    let vectorLayer = new VectorLayer({\n      name,\n      source,\n      style\n    });\n    map.addLayer(vectorLayer);\n  }, [userCoord]);\n  let draw; // global so we can remove it later\n  const addInteraction = () => {\n    draw = new Draw({\n      source: source,\n      type: \"Point\"\n    });\n    draw.on('drawend', function (evt) {\n      map === null || map === void 0 ? void 0 : map.removeInteraction(draw);\n      var feature = evt.feature;\n      var coords = feature.getGeometry().getCoordinates();\n      setUserCoord(coords);\n      message.success(\"繪製成功，請回到表單填寫地點名稱\");\n    }, this);\n    if (isDraw) {\n      map === null || map === void 0 ? void 0 : map.addInteraction(draw);\n    }\n  };\n  const clearLayer = () => {\n    map.getLayers().forEach(layer => {\n      if (layer.get('name') === 'draw') {\n        layer.getSource().clear();\n      }\n    });\n  };\n  useEffect(() => {\n    if (isDraw) {\n      clearLayer();\n      addInteraction();\n      setIsDraw(false);\n    }\n  }, [isDraw]);\n  return null;\n};\nexport default DrawVectorLayer;","map":{"version":3,"names":["React","useContext","useEffect","message","MapContext","Vector","VectorLayer","Draw","DrawVectorLayer","name","source","style","zIndex","map","isDraw","setIsDraw","userCoord","setUserCoord","vectorLayer","addLayer","setZIndex","addInteraction","removeLayer","clearLayer","draw","type","on","evt","removeInteraction","feature","coords","getGeometry","getCoordinates","success","getLayers","forEach","layer","get","getSource","clear"],"sources":["/Users/yantinglong/Documents/project/frogather/src/components/Layers/DrawVectorLayer.js"],"sourcesContent":["import React from 'react';\nimport { useContext, useEffect } from \"react\";\nimport { message } from 'antd';\nimport MapContext from \"./../../hook/MapContext\";\nimport { Vector as VectorLayer } from 'ol/layer.js';\nimport Draw from 'ol/interaction/Draw.js';\n\nconst DrawVectorLayer = ({ name, source, style, zIndex }) => {\n\tconst { map, isDraw, setIsDraw, userCoord, setUserCoord } = useContext(MapContext);\n\n\tuseEffect(()=>{\n\t\tif (!map) return;\n\t\tlet vectorLayer = new VectorLayer({\n\t\t\tname,\n\t\t\tsource,\n\t\t\tstyle\n\t\t});\n\t\tmap.addLayer(vectorLayer);\n\t\tvectorLayer.setZIndex(zIndex);\n\t\taddInteraction();\n\n\t\treturn () => {\n\t\t\tif (map) {\n\t\t\t\tmap.removeLayer(vectorLayer);\n\t\t\t}\n\t\t};\n\t}, [map]);\n\n\tuseEffect(()=>{\n\t\tif (!map) return;\n\t\tclearLayer();\n\t\tlet vectorLayer = new VectorLayer({\n\t\t\tname,\n\t\t\tsource,\n\t\t\tstyle\n\t\t});\n\t\tmap.addLayer(vectorLayer);\n\t}, [userCoord]);\n\n\tlet draw; // global so we can remove it later\n\tconst addInteraction = () => {\n\t\tdraw = new Draw({\n\t\t\tsource: source,\n\t\t\ttype: \"Point\",\n\t\t});\n\t\tdraw.on('drawend', function(evt) {\n\t\t\tmap?.removeInteraction(draw);\n\t\t\tvar feature = evt.feature;\n\t\t\tvar coords = feature.getGeometry().getCoordinates();\n\t\t\tsetUserCoord(coords);\n\t\t\tmessage.success(\"繪製成功，請回到表單填寫地點名稱\")\n\t\t}, this);\n\t\tif (isDraw) {\n\t\t\tmap?.addInteraction(draw);\n\t\t}\n\t};\n\n\tconst clearLayer = () => {\n\t\tmap.getLayers().forEach((layer) => {\n\t\t\tif (layer.get('name') === 'draw') {\n\t\t\t\tlayer.getSource().clear();\n\t\t\t}\n\t\t});\n\t};\n\n  useEffect(()=>{\n\t\tif (isDraw) {\n\t\t\tclearLayer();\n\t\t\taddInteraction();\n\t\t\tsetIsDraw(false);\n\t\t}\n  }, [isDraw]);\n\n\treturn null;\n};\n\nexport default DrawVectorLayer;"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,EAAEC,SAAS,QAAQ,OAAO;AAC7C,SAASC,OAAO,QAAQ,MAAM;AAC9B,OAAOC,UAAU,MAAM,yBAAyB;AAChD,SAASC,MAAM,IAAIC,WAAW,QAAQ,aAAa;AACnD,OAAOC,IAAI,MAAM,wBAAwB;AAEzC,MAAMC,eAAe,GAAGA,CAAC;EAAEC,IAAI;EAAEC,MAAM;EAAEC,KAAK;EAAEC;AAAO,CAAC,KAAK;EAC5D,MAAM;IAAEC,GAAG;IAAEC,MAAM;IAAEC,SAAS;IAAEC,SAAS;IAAEC;EAAa,CAAC,GAAGhB,UAAU,CAACG,UAAU,CAAC;EAElFF,SAAS,CAAC,MAAI;IACb,IAAI,CAACW,GAAG,EAAE;IACV,IAAIK,WAAW,GAAG,IAAIZ,WAAW,CAAC;MACjCG,IAAI;MACJC,MAAM;MACNC;IACD,CAAC,CAAC;IACFE,GAAG,CAACM,QAAQ,CAACD,WAAW,CAAC;IACzBA,WAAW,CAACE,SAAS,CAACR,MAAM,CAAC;IAC7BS,cAAc,CAAC,CAAC;IAEhB,OAAO,MAAM;MACZ,IAAIR,GAAG,EAAE;QACRA,GAAG,CAACS,WAAW,CAACJ,WAAW,CAAC;MAC7B;IACD,CAAC;EACF,CAAC,EAAE,CAACL,GAAG,CAAC,CAAC;EAETX,SAAS,CAAC,MAAI;IACb,IAAI,CAACW,GAAG,EAAE;IACVU,UAAU,CAAC,CAAC;IACZ,IAAIL,WAAW,GAAG,IAAIZ,WAAW,CAAC;MACjCG,IAAI;MACJC,MAAM;MACNC;IACD,CAAC,CAAC;IACFE,GAAG,CAACM,QAAQ,CAACD,WAAW,CAAC;EAC1B,CAAC,EAAE,CAACF,SAAS,CAAC,CAAC;EAEf,IAAIQ,IAAI,CAAC,CAAC;EACV,MAAMH,cAAc,GAAGA,CAAA,KAAM;IAC5BG,IAAI,GAAG,IAAIjB,IAAI,CAAC;MACfG,MAAM,EAAEA,MAAM;MACde,IAAI,EAAE;IACP,CAAC,CAAC;IACFD,IAAI,CAACE,EAAE,CAAC,SAAS,EAAE,UAASC,GAAG,EAAE;MAChCd,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEe,iBAAiB,CAACJ,IAAI,CAAC;MAC5B,IAAIK,OAAO,GAAGF,GAAG,CAACE,OAAO;MACzB,IAAIC,MAAM,GAAGD,OAAO,CAACE,WAAW,CAAC,CAAC,CAACC,cAAc,CAAC,CAAC;MACnDf,YAAY,CAACa,MAAM,CAAC;MACpB3B,OAAO,CAAC8B,OAAO,CAAC,kBAAkB,CAAC;IACpC,CAAC,EAAE,IAAI,CAAC;IACR,IAAInB,MAAM,EAAE;MACXD,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEQ,cAAc,CAACG,IAAI,CAAC;IAC1B;EACD,CAAC;EAED,MAAMD,UAAU,GAAGA,CAAA,KAAM;IACxBV,GAAG,CAACqB,SAAS,CAAC,CAAC,CAACC,OAAO,CAAEC,KAAK,IAAK;MAClC,IAAIA,KAAK,CAACC,GAAG,CAAC,MAAM,CAAC,KAAK,MAAM,EAAE;QACjCD,KAAK,CAACE,SAAS,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC;MAC1B;IACD,CAAC,CAAC;EACH,CAAC;EAEArC,SAAS,CAAC,MAAI;IACd,IAAIY,MAAM,EAAE;MACXS,UAAU,CAAC,CAAC;MACZF,cAAc,CAAC,CAAC;MAChBN,SAAS,CAAC,KAAK,CAAC;IACjB;EACA,CAAC,EAAE,CAACD,MAAM,CAAC,CAAC;EAEb,OAAO,IAAI;AACZ,CAAC;AAED,eAAeN,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module"}